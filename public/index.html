<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üöÄ Unlimited Drive Upload</title>
  <style>
    body { font-family: Arial; text-align: center; padding: 20px; background: #f3f3f3; }
    h1 { color: #3f37c9; }
    #fileList a { display: block; margin: 5px 0; color: #1e40af; word-break: break-all; }
    img, audio { margin-top: 10px; max-width: 90%; }
  </style>
</head>
<body>
  <h1>üì§ Upload to Unlimited Drive</h1>
  <input type="file" id="fileInput" />
  <button onclick="uploadFile()">Upload</button>
  <div id="message"></div>

  <h2>üìÅ Uploaded Files</h2>
  <div id="fileList">Loading...</div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const message = document.getElementById('message');
    const fileList = document.getElementById('fileList');

    const BACKUP = 'https://drive-main-storage.onrender.com';

    async function uploadFile() {
      const file = fileInput.files[0];
      if (!file) {
        message.innerHTML = "‚ùå Please choose a file!";
        return;
      }

      const formData = new FormData();
      formData.append('file', file);
      message.innerHTML = "‚è≥ Uploading...";

      try {
        const res = await fetch('/upload', { method: 'POST', body: formData });
        const data = await res.json();
        const filename = data.url.split('/').pop();
        const fullURL = `${window.location.origin}/drive-files/${filename}`;
        message.innerHTML = `‚úÖ Uploaded: <a href="${fullURL}" target="_blank">${fullURL}</a>`;
        fetchFiles();
      } catch {
        message.innerHTML = "‚ùå Upload failed.";
      }
    }

    async function fetchFiles() {
      try {
        const res = await fetch(`${BACKUP}/files`);
        const files = await res.json();
        fileList.innerHTML = "";
        files.reverse().forEach(f => {
          const name = f.url.split('/').pop();
          const proxyURL = `${window.location.origin}/drive-files/${name}`;
          const link = `<a href="${proxyURL}" target="_blank">${proxyURL}</a>`;
          const preview = name.endsWith('.jpg') || name.endsWith('.png') || name.endsWith('.jpeg')
            ? `<img src="${proxyURL}" />`
            : name.endsWith('.mp3')
            ? `<audio controls src="${proxyURL}"></audio>`
            : '';
          fileList.innerHTML += `${link}<br>${preview}<hr>`;
        });
      } catch {
        fileList.innerText = "‚ùå Failed to load files.";
      }
    }

    window.onload = fetchFiles;
  </script>
</body>
</html>
