<script>
  const BACKUP_SERVER = 'https://drive-main-storage.onrender.com';

  async function loadUploadedFiles() {
    try {
      const res = await fetch(`${BACKUP_SERVER}/files`);
      const files = await res.json();
      const fileList = document.getElementById('fileList');
      fileList.innerHTML = '';

      files.reverse().forEach(file => {
        const link = document.createElement('a');
        link.href = file.url;
        link.target = '_blank';
        link.textContent = file.url;
        fileList.appendChild(link);
        fileList.appendChild(document.createElement('br'));
      });
    } catch (e) {
      console.error('❌ Failed to load files:', e);
    }
  }

  document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const formData = new FormData(document.getElementById('uploadForm'));
    const status = document.getElementById('status');
    status.innerHTML = '⏳ Uploading...';

    try {
      const res = await fetch(`${BACKUP_SERVER}/upload`, {
        method: 'POST',
        body: formData
      });
      const data = await res.json();

      if (data.url) {
        status.innerHTML = '✅ File uploaded successfully!';
        document.getElementById('uploadForm').reset();
        await loadUploadedFiles();
      } else {
        status.innerHTML = '❌ Upload failed';
      }
    } catch (err) {
      status.innerHTML = '❌ Error uploading file';
      console.error(err);
    }
  });

  loadUploadedFiles();
</script>
